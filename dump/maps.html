<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>School Map Navigation Demo ‚Äî Smart Path</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
        background: #f8f9fa;
        padding: 20px;
      }
      .map-container {
        position: relative;
        display: inline-block;
      }
      svg {
        width: 600px;
        height: 400px;
        border: 2px solid #ccc;
        background: #fff;
        border-radius: 8px;
      }
      .shape {
        fill: rgba(0, 123, 255, 0.2);
        stroke: #007bff;
        stroke-width: 2;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .shape:hover {
        fill: rgba(0, 123, 255, 0.4);
      }
      .highlight {
        stroke: #dc3545 !important;
        fill: rgba(220, 53, 69, 0.4) !important;
      }
      #pathLine {
        stroke: #28a745;
        stroke-width: 4;
        stroke-dasharray: 8, 5;
        fill: none;
      }
    </style>
  </head>
  <body>
    <div class="container text-center">
      <h2 class="mb-4">üè´ School Map Navigation ‚Äî Smart Path</h2>

      <!-- Controls -->
      <div class="search-container mb-4">
        <div class="input-group">
          <label class="input-group-text bg-light fw-semibold" for="fromSelect"
            >From</label
          >
          <select class="form-select" id="fromSelect">
            <option selected disabled>Choose starting area...</option>
            <option value="main_gate">Main Gate</option>
            <option value="building_1">Building 1</option>
            <option value="building_2">Building 2</option>
            <option value="library">Library</option>
          </select>

          <span class="input-group-text"><i class="fas fa-search"></i></span>
          <input
            type="text"
            class="form-control"
            id="searchInput"
            placeholder="Type destination (e.g., Library)"
          />
          <button class="btn btn-primary" id="searchBtn">Go</button>
        </div>
      </div>

      <!-- SVG Map -->
      <div class="map-container">
        <svg id="overlay" viewBox="0 0 600 400">
          <!-- Path Line -->
          <polyline id="pathLine" points="" style="display: none"></polyline>

          <!-- Locations -->
          <rect
            class="shape"
            data-title="main_gate"
            x="50"
            y="300"
            width="80"
            height="50"
          ></rect>
          <text x="60" y="295" font-size="12" fill="#000">Main Gate</text>

          <rect
            class="shape"
            data-title="building_1"
            x="250"
            y="150"
            width="100"
            height="70"
          ></rect>
          <text x="260" y="140" font-size="12" fill="#000">Building 1</text>

          <rect
            class="shape"
            data-title="building_2"
            x="250"
            y="285"
            width="100"
            height="70"
          ></rect>
          <text x="260" y="280" font-size="12" fill="#000">Building 2</text>

          <rect
            class="shape"
            data-title="library"
            x="450"
            y="50"
            width="100"
            height="70"
          ></rect>
          <text x="470" y="40" font-size="12" fill="#000">Library</text>
        </svg>
      </div>
    </div>

    <script>
      const svg = document.getElementById("overlay");
      const pathLine = document.getElementById("pathLine");
      let highlightedArea = null;

      const locations = {
        main_gate: { x: 90, y: 325 },
        building_1: { x: 300, y: 185 },
        building_2: { x: 300, y: 320 },
        library: { x: 500, y: 85 },
      };

      function highlightArea(areaName) {
        if (highlightedArea) highlightedArea.classList.remove("highlight");
        const shape = document.querySelector(
          `.shape[data-title='${areaName}']`
        );
        if (shape) {
          shape.classList.add("highlight");
          highlightedArea = shape;
        }
      }

      // Helper: check if line crosses a rectangle
      function lineIntersectsRect(x1, y1, x2, y2, rect) {
        const rx = parseFloat(rect.getAttribute("x"));
        const ry = parseFloat(rect.getAttribute("y"));
        const rw = parseFloat(rect.getAttribute("width"));
        const rh = parseFloat(rect.getAttribute("height"));
        const left = rx,
          right = rx + rw,
          top = ry,
          bottom = ry + rh;

        return !(x2 < left || x1 > right || y2 < top || y1 > bottom);
      }

      // Improved routing ‚Äî adds detours if another building blocks direct path
      function getSmartPath(from, to) {
        let points = [[from.x, from.y]];

        const obstacles = Array.from(document.querySelectorAll(".shape"));
        let x = from.x,
          y = from.y;

        // Basic L path
        let midX = x,
          midY = y;

        // Try horizontal then vertical
        midX = to.x;
        midY = from.y;

        // Check if crossing any building
        let blocked = obstacles.some((rect) =>
          lineIntersectsRect(x, y, midX, midY, rect)
        );

        if (blocked) {
          // Move slightly around obstacle ‚Äî add detour
          midY = from.y - 50; // move upward path
        }

        points.push([midX, midY]);

        // Second leg (vertical)
        blocked = obstacles.some((rect) =>
          lineIntersectsRect(midX, midY, to.x, to.y, rect)
        );

        if (blocked) {
          // Detour horizontally instead
          midX += 50;
        }

        points.push([to.x, to.y]);

        return points.map((p) => p.join(",")).join(" ");
      }

      function drawPath(from, to) {
        const points = getSmartPath(from, to);
        pathLine.setAttribute("points", points);
        pathLine.style.display = "block";
      }

      document.getElementById("searchBtn").addEventListener("click", () => {
        const fromSelect = document.getElementById("fromSelect").value;
        const searchValue = document
          .getElementById("searchInput")
          .value.toLowerCase()
          .trim();

        if (!fromSelect) return alert("Please choose a starting area first.");
        if (!searchValue) return alert("Please type a destination.");

        const destination = Object.keys(locations).find((loc) =>
          loc.includes(searchValue)
        );
        if (!destination)
          return alert("Destination not found. Try 'Library' or 'Building 1'.");

        drawPath(locations[fromSelect], locations[destination]);
        highlightArea(destination);
      });

      document.querySelectorAll(".shape").forEach((shape) => {
        shape.addEventListener("click", () => {
          const dest = shape.dataset.title;
          const from = document.getElementById("fromSelect").value;
          if (!from) return alert("Select a starting point first.");
          drawPath(locations[from], locations[dest]);
          highlightArea(dest);
        });
      });
    </script>
  </body>
</html>
